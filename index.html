<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Learning Companion - AI Chat with Learning Capture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            width: 32px;
            height: 32px;
            background: #6366f1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        /* Chat Container */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
        }
        
        /* Messages */
        .message {
            margin-bottom: 24px;
            display: flex;
            gap: 12px;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .avatar.user {
            background: #6366f1;
            color: white;
        }
        
        .avatar.assistant {
            background: #f97316;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .message-content {
            flex: 1;
        }
        
        .message-text {
            background: white;
            padding: 12px 16px;
            border-radius: 12px;
            line-height: 1.5;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .user-message .message-text {
            background: #6366f1;
            color: white;
        }
        
        /* Input Area */
        .input-container {
            background: white;
            border-top: 1px solid #e0e0e0;
            padding: 16px 24px;
        }
        
        .input-wrapper {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            gap: 12px;
        }
        
        .input-field {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
        }
        
        .input-field:focus {
            border-color: #6366f1;
        }
        
        .send-button {
            padding: 12px 24px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .send-button:hover {
            background: #5558e3;
        }
        
        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        /* Floating Capture Button */
        .capture-button {
            position: fixed;
            bottom: 100px;
            right: 30px;
            padding: 12px 24px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .capture-button:hover {
            background: #5558e3;
            transform: translateY(-2px);
        }
        
        /* Modal */
        .modal-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-container.show {
            display: flex;
        }
        
        .modal {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 20px;
        }
        
        .close-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #f5f5f5;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            color: #666;
        }
        
        /* Modal Steps */
        .modal-step {
            padding: 24px;
            display: none;
        }
        
        .modal-step.active {
            display: block;
        }
        
        /* Audience Selection */
        .audience-intro {
            margin-bottom: 20px;
            color: #555;
        }
        
        .audience-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .audience-btn {
            padding: 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            font-size: 16px;
            transition: all 0.2s;
        }
        
        .audience-btn:hover {
            border-color: #6366f1;
            background: #f5f5ff;
        }
        
        .audience-btn.selected {
            border-color: #6366f1;
            background: #6366f1;
            color: white;
        }
        
        /* Form */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
        }
        
        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #6366f1;
        }
        
        /* AI Enhancement */
        .ai-section {
            margin-bottom: 24px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .ai-section h4 {
            margin: 0 0 12px 0;
            font-size: 16px;
            color: #333;
        }
        
        .socratic-question {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 6px;
            font-style: italic;
            margin-bottom: 12px;
        }
        
        .key-learning {
            background: #fff3e0;
            padding: 12px;
            border-radius: 6px;
            font-weight: 500;
        }
        
        /* Buttons */
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #6366f1;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5558e3;
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }
        
        /* Share Card */
        .share-card {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            white-space: pre-wrap;
            font-family: -apple-system, sans-serif;
        }
        
        .copy-btn {
            width: 100%;
            padding: 12px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .copy-btn:hover {
            background: #45a049;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 2000;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">M</div>
        <h3>Meno Learning Companion</h3>
    </div>
    
    <!-- Chat Container -->
    <div class="chat-container" id="chatContainer">
        <!-- Welcome Message -->
        <div class="message">
            <div class="avatar assistant">Meno</div>
            <div class="message-content">
                <div class="message-text">
                    Hello! I'm Meno, your AI assistant. Like my namesake from Plato's dialogue, I'm here to help you discover knowledge through thoughtful questioning. Ask me about debugging, coding problems, or any technical challenges you're facing. When you solve something interesting, click the "💡 Capture Learning" button to create a shareable insight for your team!
                </div>
            </div>
        </div>
    </div>
    
    <!-- Input Area -->
    <div class="input-container">
        <div class="input-wrapper">
            <input 
                type="text" 
                class="input-field" 
                id="messageInput" 
                placeholder="Ask me anything..."
                onkeypress="handleKeyPress(event)"
            >
            <button class="send-button" id="sendButton" onclick="sendMessage()">
                Send
            </button>
        </div>
    </div>
    
    <!-- Floating Capture Button -->
    <button class="capture-button" onclick="startCapture()">
        💡 Capture Learning
    </button>
    
    <!-- Capture Modal -->
    <div class="modal-container" id="modalContainer">
        <div class="modal">
            <div class="modal-header">
                <h3>💡 Capture Your Learning</h3>
                <button class="close-btn" onclick="closeModal()">×</button>
            </div>
            
            <!-- Step 1: Audience Selection -->
            <div class="modal-step active" id="step1">
                <p class="audience-intro">
                    I'll help track this problem and solution. Who might face this same problem?
                </p>
                <div class="audience-buttons">
                    <button class="audience-btn" onclick="selectAudience('team')">
                        👥 My Team
                    </button>
                    <button class="audience-btn" onclick="selectAudience('future')">
                        🔮 Future me
                    </button>
                    <button class="audience-btn" onclick="selectAudience('new')">
                        🆕 New hires
                    </button>
                </div>
                
                <form id="captureForm">
                    <div class="form-group">
                        <label>What was the problem?</label>
                        <input type="text" id="problemInput" required>
                    </div>
                    <div class="form-group">
                        <label>What was its cause?</label>
                        <input type="text" id="causeInput" required>
                    </div>
                    <div class="form-group">
                        <label>What was the solution?</label>
                        <textarea id="solutionInput" rows="3" required></textarea>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">Generate Card</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            </div>
            
            <!-- Step 2: AI Enhancement -->
            <div class="modal-step" id="step2">
                <div class="ai-section">
                    <h4>🤖 AI Analysis</h4>
                    <p id="aiAnalysis">Analyzing your conversation context...</p>
                </div>
                
                <div class="ai-section">
                    <h4>🤔 Deeper Understanding</h4>
                    <div class="socratic-question" id="socraticQuestion">
                        Generating contextual question...
                    </div>
                    <textarea placeholder="Your thoughts (optional)..." rows="3"></textarea>
                </div>
                
                <div class="ai-section">
                    <h4>💭 How confident are you in your understanding?</h4>
                    <div class="confidence-buttons">
                        <button class="confidence-btn" onclick="setConfidence('low')">
                            😕 Still learning
                        </button>
                        <button class="confidence-btn" onclick="setConfidence('medium')">
                            🤔 Somewhat confident
                        </button>
                        <button class="confidence-btn" onclick="setConfidence('high')">
                            😊 Very confident
                        </button>
                    </div>
                </div>
                
                <div class="ai-section">
                    <h4>💡 Key Learning</h4>
                    <div class="key-learning" id="keyLearning">
                        Extracting key insight...
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="goBackToStep1()">← Back</button>
                    <button class="btn btn-primary" onclick="showShareCard()">Continue</button>
                </div>
            </div>
            
            <!-- Step 3: Share Card -->
            <div class="modal-step" id="step3">
                <div class="share-card" id="shareCard"></div>
                <button class="copy-btn" onclick="copyToClipboard()">📋 Copy to Clipboard</button>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
    
    <script>
        // Store conversation history
        let conversationHistory = [];
        let selectedAudience = '';
        let currentCapture = {};
        let selectedConfidence = '';
        
        // Set confidence level
        function setConfidence(level) {
            selectedConfidence = level;
            document.querySelectorAll('.confidence-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }
        
        // Go back to step 1
        function goBackToStep1() {
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step1').classList.add('active');
        }
        
        // Handle enter key
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                sendMessage();
            }
        }
        
        // Send message
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Disable input while processing
            input.disabled = true;
            document.getElementById('sendButton').disabled = true;
            
            // Add user message
            addMessage(message, 'user');
            conversationHistory.push({ role: 'user', content: message });
            
            // Clear input
            input.value = '';
            
            // Simulate AI response (in production, this would call Claude API)
            const response = await getAIResponse(message);
            
            // Add AI response
            addMessage(response, 'assistant');
            conversationHistory.push({ role: 'assistant', content: response });
            
            // Re-enable input
            input.disabled = false;
            document.getElementById('sendButton').disabled = false;
            input.focus();
        }
        
        // Add message to chat
        function addMessage(content, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            messageDiv.innerHTML = `
                <div class="avatar ${sender}">${sender === 'user' ? 'You' : 'Meno'}</div>
                <div class="message-content">
                    <div class="message-text">${content}</div>
                </div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Simulate AI response (replace with actual Claude API call)
        async function getAIResponse(message) {
            // Simulate thinking time
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const lowerMessage = message.toLowerCase();
            
            // Context-aware responses
            if (lowerMessage.includes('slow') || lowerMessage.includes('performance') || lowerMessage.includes('timeout')) {
                return "Performance issues often stem from inefficient queries or algorithms. Have you checked:\n\n1. Database query efficiency (N+1 queries?)\n2. Caching opportunities\n3. Algorithm complexity\n\nCan you tell me more about what's running slowly?";
            } 
            
            if (lowerMessage.includes('error') || lowerMessage.includes('bug') || lowerMessage.includes('broken')) {
                return "I can help debug that error. To better assist you:\n\n1. What's the exact error message?\n2. When does it occur?\n3. Have you checked the logs?\n\nShare the error details and I'll help you troubleshoot.";
            }
            
            if (lowerMessage.includes('fix') || lowerMessage.includes('solve') || lowerMessage.includes('solution')) {
                return "Great question! Based on what you've described, here's a solution:\n\n1. First, identify the root cause\n2. Apply the appropriate fix\n3. Test thoroughly\n4. Document the solution\n\nWould you like me to elaborate on any of these steps?";
            }
            
            if (lowerMessage.includes('api')) {
                return "API issues can be tricky. Common causes include:\n\n1. Authentication/authorization problems\n2. Rate limiting\n3. Timeout settings\n4. Incorrect request format\n\nWhat specific behavior are you seeing with your API?";
            }
            
            if (lowerMessage.includes('database') || lowerMessage.includes('query') || lowerMessage.includes('sql')) {
                return "Database performance is crucial. Let's check:\n\n1. Are your queries using proper indexes?\n2. Any N+1 query problems?\n3. Connection pool settings?\n4. Query execution plans?\n\nWhat database system are you using?";
            }
            
            if (lowerMessage.includes('deploy') || lowerMessage.includes('production')) {
                return "Deployment issues require careful debugging. Consider:\n\n1. Environment variable differences\n2. Database migration status\n3. Build/compilation errors\n4. Server configuration\n\nWhat happens when you try to deploy?";
            }
            
            if (lowerMessage.includes('test') || lowerMessage.includes('testing')) {
                return "Testing is essential for reliable code. I can help with:\n\n1. Unit test strategies\n2. Integration testing\n3. Test coverage\n4. Mocking and stubbing\n\nWhat aspect of testing are you working on?";
            }
            
            // If discussing a solution or fix
            if (conversationHistory.length > 2 && (lowerMessage.includes('worked') || lowerMessage.includes('fixed') || lowerMessage.includes('solved'))) {
                return "Excellent! You've solved the problem. This is a great learning moment.\n\nTo help others who might face this issue:\n1. What was the root cause?\n2. How did you identify it?\n3. What's the key insight here?\n\nConsider clicking '💡 Capture Learning' to document this solution for your team!";
            }
            
            // Default response for unmatched patterns
            return "I understand. Let me help you with that. Can you provide more details about the specific issue you're facing?";
        }
        
        // Start capture flow
        function startCapture() {
            if (conversationHistory.length < 2) {
                showToast('Have a conversation first before capturing learnings!');
                return;
            }
            
            document.getElementById('modalContainer').classList.add('show');
            
            // Pre-fill based on conversation
            prefillCapture();
        }
        
        // Prefill capture form based on conversation
        function prefillCapture() {
            // Simple extraction logic (in production, use AI)
            const lastMessages = conversationHistory.slice(-4);
            
            // Try to extract problem from user messages
            const userMessages = lastMessages.filter(m => m.role === 'user');
            if (userMessages.length > 0) {
                const problemText = userMessages[userMessages.length - 1].content;
                document.getElementById('problemInput').value = problemText.substring(0, 100);
            }
        }
        
        // Select audience
        function selectAudience(audience) {
            selectedAudience = audience;
            document.querySelectorAll('.audience-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }
        
        // Handle form submission
        document.getElementById('captureForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!selectedAudience) {
                showToast('Please select an audience first');
                return;
            }
            
            // Capture form data
            currentCapture = {
                audience: selectedAudience,
                problem: document.getElementById('problemInput').value,
                cause: document.getElementById('causeInput').value,
                solution: document.getElementById('solutionInput').value,
                timestamp: new Date().toISOString()
            };
            
            // Move to AI enhancement step
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step2').classList.add('active');
            
            // Generate AI enhancements
            await performAIAnalysis();
        });
        
        // Perform AI analysis
        async function performAIAnalysis() {
            // Simulate API calls
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Update AI analysis
            document.getElementById('aiAnalysis').innerHTML = 
                "✅ Your summary aligns well with the conversation. The problem and solution are clearly articulated.";
            
            // Generate audience-specific Socratic question
            const audienceContext = {
                'team': {
                    context: "your team might ask at standup",
                    questions: [
                        "What happens if this same issue occurs in our microservices?",
                        "How can we prevent this from happening in other endpoints?",
                        "What's the performance impact we should expect?",
                        "Should we add monitoring for this pattern?"
                    ]
                },
                'future': {
                    context: "you might ask yourself in 6 months",
                    questions: [
                        "What were the specific symptoms that led to this diagnosis?",
                        "What tools or commands did I use to identify this?",
                        "Are there any edge cases I should remember?",
                        "What would I check first if this happens again?"
                    ]
                },
                'new': {
                    context: "a new hire might ask during onboarding",
                    questions: [
                        "What background knowledge is needed to understand this fix?",
                        "Are there any documentation or resources about this pattern?",
                        "What's the difference between the broken and fixed approaches?",
                        "How common is this type of issue in our codebase?"
                    ]
                }
            };
            
            const audience = selectedAudience || 'team';
            const contextInfo = audienceContext[audience];
            const randomQuestion = contextInfo.questions[Math.floor(Math.random() * contextInfo.questions.length)];
            
            const socraticIntro = `Good fix! Here's something ${contextInfo.context}:\n\n"${randomQuestion}"\n\nHow might you answer it?`;
            
            document.getElementById('socraticQuestion').textContent = socraticIntro;
            currentCapture.socraticQuestion = randomQuestion;
            
            // Generate key learning
            document.getElementById('keyLearning').textContent = 
                "Always investigate root causes before implementing solutions - symptoms often mask deeper issues.";
            
            currentCapture.keyLearning = document.getElementById('keyLearning').textContent;
        }
        
        // Show share card
        function showShareCard() {
            const audienceEmoji = {
                'team': '👥 Team',
                'future': '🔮 Future Reference',
                'new': '🆕 New Hire Guide'
            };
            
            const shareText = `🐛 Debug Win

**Problem:** ${currentCapture.problem}
**Cause:** ${currentCapture.cause}
**Solution:** ${currentCapture.solution}

💡 **Key Learning:** ${currentCapture.keyLearning}

🤔 **Consider:** ${currentCapture.socraticQuestion}

📝 **Audience:** ${audienceEmoji[currentCapture.audience] || 'Team'}
⏱️ **Captured:** ${new Date().toLocaleDateString()}`;
            
            document.getElementById('shareCard').textContent = shareText;
            currentCapture.shareText = shareText;
            
            // Move to share step
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.add('active');
        }
        
        // Copy to clipboard
        function copyToClipboard() {
            navigator.clipboard.writeText(currentCapture.shareText).then(() => {
                showToast('Copied to clipboard! 📋');
                setTimeout(() => {
                    closeModal();
                }, 1500);
            });
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('modalContainer').classList.remove('show');
            // Reset form
            document.getElementById('captureForm').reset();
            document.querySelectorAll('.audience-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            // Reset steps
            document.querySelectorAll('.modal-step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById('step1').classList.add('active');
            selectedAudience = '';
        }
        
        // Show toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Close modal on backdrop click
        document.getElementById('modalContainer').addEventListener('click', (e) => {
            if (e.target === document.getElementById('modalContainer')) {
                closeModal();
            }
        });
    </script>
</body>
</html>
